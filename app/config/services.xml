<?xml version="1.0" encoding="UTF-8" ?>

<container xmlns="http://symfony.com/schema/dic/services"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

        <services>
            <service id="command.info"
                class="DotfilesInstaller\Command\InfoCommand"
                >
                <argument type="service" id="main.installation" />
                <argument type="service" id="instruction.processor" />
                <tag name="command" />
            </service>
            <service id="command.init"
                class="DotfilesInstaller\Command\InitCommand"
                >
                <argument type="service" id="main.installation" />
                <tag name="command" />
            </service>
            <service id="command.install"
                class="DotfilesInstaller\Command\InstallCommand"
                >
                <argument type="service" id="main.installation" />
                <argument type="service" id="instruction.processor" />
                <tag name="command" />
            </service>

            <service id="main.installation"
                class="DotfilesInstaller\Component\Installation"
                >
                <factory service="installation.factory" method="create" />
                <argument>%config_path%</argument>
            </service>

            <service id="installation.factory"
                class="DotfilesInstaller\Component\InstallationFactory"
                >
                <argument type="service" id="util.path_converter" />
                <argument type="service" id="instruction.loader" />
            </service>

            <service id="instruction.loader"
                class="DotfilesInstaller\Component\Instruction\Loader\InstructionLoader"
                >
            </service>

            <service id="instruction.processor" alias="instruction.processor.chain" />

            <service id="instruction.processor.chain" class="Mmc\Processor\Component\ChainProcessor">
                <call method="add">
                    <argument type="service" id="instruction.processor.link" />
                    <argument>LinkProcessor</argument>
                </call>
                <call method="add">
                    <argument type="service" id="instruction.manager.remote" />
                    <argument>RemoteManager</argument>
                </call>
            </service>

            <service id="instruction.processor.link" class="DotfilesInstaller\Component\Instruction\Processor\LinkProcessor">
                <argument>%repositories_path%</argument>
                <argument type="service" id="util.path_converter" />
            </service>

            <service id="util.path_converter"
                class="DotfilesInstaller\Component\Util\PathConverter"
                >
            </service>
        </services>
</container>

